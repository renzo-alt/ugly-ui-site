# .github/workflows/deploy.yml
name: CI - Lint and Unit Test

on:
  # Triggers on pushes to the main branch
  push:
    branches: [ main ]
  # Triggers on all pull requests targeting main
  pull_request:
    branches: [ main ]
  # Allows manual triggering
  workflow_dispatch:

jobs:
  # 1. Lint Job
  lint:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Node.js 20
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install dependencies
        run: npm install

      - name: Run ESLint (npm run lint)
        # Executes the "lint" script defined in your package.json
        run: npm run lint 

  # 2. Test Job (Requires Lint to Pass)
  test:
    needs: lint # Dependency: This ensures the 'lint' job must succeed first
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Node.js 20
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install dependencies
        # Installs all packages, including Jest and jQuery
        run: npm install
        
      - name: Run Jest Tests (npm test)
        # Executes the "test" script defined in your package.json
        run: npm test